@using Microsoft.AspNet.Identity;
@using CinemaTicketHub.Models
@using Microsoft.AspNet.Identity.EntityFramework;

@{
    var userManager = new UserManager<ApplicationUser>(new UserStore<ApplicationUser>(new ApplicationDbContext()));
    var user = userManager.FindById(User.Identity.GetUserId());
    var roles = userManager.GetRoles(user.Id);
    var userrole = roles.FirstOrDefault();
}

@{
    ViewBag.Title = "Thông tin cá nhân";
}

<style>
    #avatar {
        cursor: pointer;
        transition: transform 0.3s;
    }

        #avatar:hover {
            transform: scale(1.1);
        }

</style>

<div class="container" style="min-height: 80.8vh">
    <h2 style="text-align: center; margin: 50px 0">THÔNG TIN CÁ NHÂN</h2>
    <div class="main-body">
        <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex flex-column align-items-center text-center">
                            <div class="dropdown">
                                <img id="avatar" src="@user.Avatar" alt="Avatar" class="rounded-circle" width="150" title="Ấn để xem thêm tùy chọn">
                                <ul id="dropdownMenu" class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownBlog">
                                    <li><a class="dropdown-item" href="#" onclick="showAvatar()"><i class="fa-regular fa-eye" style="color: #000000;"></i> Xem Avatar</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fa-regular fa-pen-to-square" style="color: #000000;"></i> Thay đổi Avatar</a></li>
                                </ul>
                            </div>

                            <div class="mt-3">
                                <h4>@user.Name</h4>
                                <p class="text-secondary mb-1">@userrole</p>
                                @*<p class="text-muted font-size-sm">Điểm tích lũy: 100</p>*@
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="col-md-8">
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Họ và tên:</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @user.Name
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Email:</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @user.Email
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Số điện thoại:</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @user.PhoneNumber
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Ngày sinh:</h6>
                            </div>
                            <div class="col-sm-9 text-secondary">
                                @user.Birthday.ToShortDateString()
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-sm-3">
                                <h6 class="mb-0">Xác minh:</h6>
                            </div>
                            @if (user.EmailConfirmed == true)
                            {
                                <div class="col-sm-9 text-secondary">
                                    <i class="fa-solid fa-circle-check" style="color: #005eff;"></i> Đã xác minh tài khoản
                                </div>
                            }
                            else
                            {
                                <div class="col-sm-9 text-secondary">
                                    Chưa xác minh tài khoản
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-end">
                        <a href="#" class="btn btn-outline-primary" style="margin-left: 15px">Thay đổi thông tin</a>
                        <a href="/Manage/ChangePassword" class="btn btn-outline-danger" style="margin-left: 15px">Đổi mật khẩu</a>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>

<script src="https://kit.fontawesome.com/818e023cf2.js" crossorigin="anonymous"></script>

<script>
    // Lấy tham chiếu đến các phần tử cần xử lý
    const avatar = document.getElementById('avatar');
    const dropdownMenu = document.getElementById('dropdownMenu');

    // Xử lý sự kiện nhấp chuột vào hình ảnh
    avatar.addEventListener('click', function () {
        // Kiểm tra trạng thái hiển thị của dropdownlist
        const isVisible = dropdownMenu.style.display === 'block';

        // Đảo ngược trạng thái hiển thị của dropdownlist
        dropdownMenu.style.display = isVisible ? 'none' : 'block';
    });

    // Đóng dropdownlist khi người dùng nhấp chuột bất kỳ nơi ngoài dropdownlist
    window.addEventListener('click', function (event) {
        if (!avatar.contains(event.target)) {
            dropdownMenu.style.display = 'none';
        }
    });

    //Xem Avatar
        function showAvatar() {
        var avatarSrc = document.getElementById("avatar").src;
        var overlay = document.createElement("div");
        overlay.style.position = "fixed";
        overlay.style.top = "0";
        overlay.style.left = "0";
        overlay.style.width = "100%";
        overlay.style.height = "100%";
        overlay.style.background = "rgba(0, 0, 0, 0.5)";
        overlay.style.zIndex = "9999";

        var img = document.createElement("img");
        img.src = avatarSrc;
        img.style.position = "absolute";
        img.style.top = "50%";
        img.style.left = "50%";
        img.style.transform = "translate(-50%, -50%)";
        img.style.maxWidth = "90%";
        img.style.maxHeight = "90%";

        overlay.appendChild(img);
        document.body.appendChild(overlay);

        overlay.onclick = function () {
            document.body.removeChild(overlay);
        };
    }
</script>